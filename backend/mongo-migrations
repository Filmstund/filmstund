### Pending migrations ###

### Migrations already done in deployed application ###
#
# Add archived flag
db.movie.update({}, {$set: {"archived": false}}, {upsert: false, multi:true})

# Remove all IMDb ID
db.movie.update({}, {$set: {"imdbId": {"value" : null,"state" : "Missing"}}}, {upsert: false, multi:true})

# Update participants to new format introduced in feature/ftg-biljetter
db.showing.find({}).forEach(s => {
    newParts = s.participants.map(p => {
       return {
            userId: p,
            _class: "rocks.didit.sefilm.domain.SwishParticipant"
          };
    });
    s.participants = newParts;
    db.showing.save(s);
});

# Remove old bioklubbnummer
db.getCollection('user').updateMany( {}, {$unset: {"bioklubbnummer": "", "sfMembershipId": ""}})
# Remove old non-working posters
db.getCollection('movie').updateMany({poster: /.*msprod-catalogapi.*/}, {$unset: {"poster": ""}})

